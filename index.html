<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>POODi ì±—ë´‡ ë§›ë³´ê¸°</title>

  <style>
    /* =========================
       SUIT FONT (ì‚¬ìš©ì ì œê³µ)
    ========================= */
    @font-face {
      font-family: 'Suit';
      src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_suit@1.0/SUIT-Thin.woff2') format('woff2');
      font-weight: 100;
      font-display: swap;
    }
    @font-face {
      font-family: 'Suit';
      src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_suit@1.0/SUIT-ExtraLight.woff2') format('woff2');
      font-weight: 200;
      font-display: swap;
    }
    @font-face {
      font-family: 'Suit';
      src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_suit@1.0/SUIT-Light.woff2') format('woff2');
      font-weight: 300;
      font-display: swap;
    }
    @font-face {
      font-family: 'Suit';
      src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_suit@1.0/SUIT-Regular.woff2') format('woff2');
      font-weight: normal;
      font-display: swap;
    }
    @font-face {
      font-family: 'Suit';
      src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_suit@1.0/SUIT-Medium.woff2') format('woff2');
      font-weight: 500;
      font-display: swap;
    }
    @font-face {
      font-family: 'Suit';
      src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_suit@1.0/SUIT-SemiBold.woff2') format('woff2');
      font-weight: 600;
      font-display: swap;
    }
    @font-face {
      font-family: 'Suit';
      src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_suit@1.0/SUIT-Bold.woff2') format('woff2');
      font-weight: 700;
      font-display: swap;
    }
    @font-face {
      font-family: 'Suit';
      src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_suit@1.0/SUIT-ExtraBold.woff2') format('woff2');
      font-weight: 800;
      font-display: swap;
    }
    @font-face {
      font-family: 'Suit';
      src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_suit@1.0/SUIT-Heavy.woff2') format('woff2');
      font-weight: 900;
      font-display: swap;
    }

    :root{
      --bg:#0b0f1f;
      --panel:#0f1734;
      --card:#111a3a;
      --border: rgba(255,255,255,.10);
      --text:#ffffff;
      --muted: rgba(255,255,255,.65);
      --me: rgba(124, 196, 255, .20);
      --bot: rgba(255,255,255,.08);
      --danger: rgba(255, 120, 120, .18);
      --accent: #7cc4ff;
    }

    *{box-sizing:border-box;}
    body{
      margin:0;
      font-family: 'Suit', system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      background: radial-gradient(1200px 500px at 20% 0%, rgba(124,196,255,.18), transparent 60%),
                  radial-gradient(900px 500px at 90% 30%, rgba(167,126,255,.14), transparent 55%),
                  var(--bg);
      color: var(--text);
    }

    .layout{
      display:grid;
      grid-template-columns: 320px 1fr;
      gap: 16px;
      padding: 18px;
      min-height: 100vh;
    }

    /* Sidebar */
    .sidebar{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 16px;
      overflow:hidden;
    }

    .brand{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      margin-bottom: 12px;
    }

    .brand h1{
      font-size: 18px;
      margin:0;
      font-weight: 800;
      letter-spacing: .2px;
    }
    .pill{
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      border: 1px solid var(--border);
      color: var(--muted);
      font-weight: 600;
    }

    .sectionTitle{
      margin-top: 14px;
      margin-bottom: 10px;
      font-size: 13px;
      color: var(--muted);
      font-weight: 600;
    }

    .petList{
      display:flex;
      flex-direction:column;
      gap: 10px;
    }

    .petCard{
      display:flex;
      gap: 12px;
      padding: 12px;
      border-radius: 14px;
      background: rgba(255,255,255,.04);
      border: 1px solid var(--border);
      cursor:pointer;
      transition: transform .08s ease, background .08s ease, border-color .08s ease;
      user-select:none;
    }
    .petCard:hover{ transform: translateY(-1px); background: rgba(255,255,255,.06); }
    .petCard.active{
      background: rgba(124,196,255,.12);
      border-color: rgba(124,196,255,.45);
      box-shadow: 0 0 0 2px rgba(124,196,255,.12) inset;
    }

    .avatar{
      width: 46px;
      height: 46px;
      border-radius: 14px;
      border: 1px solid var(--border);
      overflow:hidden;
      flex: 0 0 46px;
      background: rgba(255,255,255,.04);
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .petInfo{
      min-width:0;
      flex:1;
    }
    .petNameRow{
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap: 8px;
      margin-bottom: 4px;
    }
    .petName{
      font-size: 15px;
      font-weight: 800;
      margin:0;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .petType{
      font-size: 12px;
      color: var(--muted);
      font-weight: 600;
      white-space:nowrap;
    }
    .petMeta{
      font-size: 12px;
      color: rgba(255,255,255,.78);
      line-height: 1.35;
    }
    .tagRow{
      margin-top: 6px;
      display:flex;
      flex-wrap:wrap;
      gap: 6px;
    }
    .tag{
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      border: 1px solid var(--border);
      color: var(--muted);
      font-weight: 600;
    }

    .hintBox{
      margin-top: 14px;
      padding: 12px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.03);
      color: var(--muted);
      font-size: 12px;
      line-height: 1.45;
    }

    /* Main */
    .main{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 16px;
      display:flex;
      flex-direction:column;
      min-width: 0;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      padding-bottom: 12px;
      border-bottom: 1px solid var(--border);
      margin-bottom: 12px;
    }

    .title{
      display:flex;
      flex-direction:column;
      gap: 2px;
      min-width:0;
    }
    .title h2{
      margin:0;
      font-size: 18px;
      font-weight: 800;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .subtitle{
      font-size: 12px;
      color: var(--muted);
      font-weight: 500;
    }

    .actions{
      display:flex;
      gap: 10px;
      align-items:center;
    }
    .btn{
      appearance:none;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.92);
      padding: 10px 12px;
      border-radius: 12px;
      cursor:pointer;
      font-weight: 700;
      font-size: 13px;
    }
    .btn:hover{ background: rgba(255,255,255,.09); }
    .btn.primary{
      background: rgba(124,196,255,.16);
      border-color: rgba(124,196,255,.35);
      color: #eaf6ff;
    }
    .btn.primary:hover{ background: rgba(124,196,255,.22); }

    #chat{
      flex:1;
      border: 1px solid var(--border);
      background: rgba(0,0,0,.10);
      border-radius: 14px;
      padding: 14px;
      overflow:auto;
      min-height: 340px;
    }

    .msg{ margin: 10px 0; display:flex; }
    .msg.me{ justify-content:flex-end; }
    .bubble{
      max-width: 78%;
      padding: 10px 12px;
      border-radius: 14px;
      background: var(--bot);
      border: 1px solid rgba(255,255,255,.08);
      white-space: pre-wrap;
      word-break: break-word;
      line-height: 1.45;
      font-size: 14px;
    }
    .msg.me .bubble{
      background: var(--me);
      border-color: rgba(124,196,255,.18);
    }
    .msg.error .bubble{
      background: var(--danger);
      border-color: rgba(255, 120, 120, .25);
    }

    .composer{
      margin-top: 12px;
      display:flex;
      gap: 10px;
    }
    input{
      flex:1;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.05);
      color: #fff;
      outline:none;
      font-size: 14px;
      font-family: inherit;
    }
    input::placeholder{ color: rgba(255,255,255,.42); }

    .send{
      min-width: 92px;
    }

    .quickRow{
      margin-top: 10px;
      display:flex;
      gap: 8px;
      flex-wrap:wrap;
    }
    .quick{
      font-size: 12px;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.05);
      color: rgba(255,255,255,.85);
      cursor:pointer;
      font-weight: 700;
    }
    .quick:hover{ background: rgba(255,255,255,.08); }

    @media (max-width: 980px){
      .layout{ grid-template-columns: 1fr; }
      .sidebar{ order: 2; }
      .main{ order: 1; }
    }
  </style>
</head>

<body>
  <div class="layout">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="brand">
        <h1>POODi ì±—ë´‡ ë§›ë³´ê¸°</h1>
        <span class="pill">í« ì„ íƒ</span>
      </div>

      <div class="sectionTitle">ëŒ€ìƒ ì„ íƒ</div>
      <div id="petList" class="petList"></div>

      <div class="hintBox">
        <b style="color:#fff;">ë™ì‘ ê·œì¹™</b><br/>
        ì„ íƒí•œ í«ì— ëŒ€í•´ì„œë§Œ ë‹µë³€í•´ìš”.<br/>
        ë‹¤ë¥¸ ì§ˆë¬¸ì„ í•˜ë©´ â€œì„ íƒí•œ í« ê´€ë ¨ìœ¼ë¡œ ì§ˆë¬¸í•´ ë‹¬ë¼â€ê³  ì•ˆë‚´í•©ë‹ˆë‹¤.
      </div>
    </aside>

    <!-- Main -->
    <main class="main">
      <div class="topbar">
        <div class="title">
          <h2 id="headerTitle">â€”</h2>
          <div id="headerSub" class="subtitle">â€”</div>
        </div>
        <div class="actions">
          <button id="clearBtn" class="btn">ëŒ€í™” ì§€ìš°ê¸°</button>
          <button id="resetBtn" class="btn primary">í« ë³€ê²½ ì•ˆë‚´</button>
        </div>
      </div>

      <div id="chat"></div>

      <div class="quickRow" id="quickRow"></div>

      <form id="form" class="composer">
        <input id="input" placeholder="ì„ íƒí•œ í«ì— ëŒ€í•´ ë¬¼ì–´ë³´ì„¸ìš”â€¦" autocomplete="off" />
        <button id="sendBtn" class="btn primary send" type="submit">ì „ì†¡</button>
      </form>
    </main>
  </div>

  <script>
    // =========================
    // í« í”„ë¡œí•„ (í”„ë¡ íŠ¸ í‘œì‹œìš©)
    // =========================
    const PETS = [
      {
        id: "mungchi",
        name: "ë­‰ì¹˜",
        type: "ê°•ì•„ì§€ Â· ì‹œì¸„ Â· ë‚¨ì•„ Â· 4ì„¸",
        meta: "í”¼ë¶€ì—¼ì´ ìˆì–´ìš”.",
        tags: ["í”¼ë¶€", "ê°€ë ¤ì›€", "ìƒ´í‘¸/ë³´ìŠµ"],
        quick: ["í”¼ë¶€ì—¼ ê´€ë¦¬ ë£¨í‹´ ì•Œë ¤ì¤˜", "ê°„ì‹ì€ í”¼ë¶€ì— ë­ê°€ ì¢‹ì•„?", "ëª©ìš• ì£¼ê¸°ëŠ” ì–´ë–»ê²Œ?"],
        avatarSvg: avatarDog("#7cc4ff", "SHIHTZU")
      },
      {
        id: "gwangsu",
        name: "ê´‘ìˆ˜",
        type: "ê°•ì•„ì§€ Â· ë² ë“¤ë§í„´ í…Œë¦¬ì–´ Â· 1ì„¸",
        meta: "ê´€ì ˆì´ ì•ˆ ì¢‹ì•„ìš”.",
        tags: ["ê´€ì ˆ", "ìš´ë™", "ì˜ì–‘"],
        quick: ["ê´€ì ˆì— ì¢‹ì€ ìš´ë™ì€?", "ë¯¸ë„ëŸ¼ ë°©ì§€ ì–´ë–»ê²Œ í•´?", "ê´€ì ˆ ë³´ì¡°ì œ ê¸°ì¤€ ì•Œë ¤ì¤˜"],
        avatarSvg: avatarDog("#a77eff", "BEDL")
      },
      {
        id: "loui",
        name: "ë£¨ì´",
        type: "ê³ ì–‘ì´ Â· ëŸ¬ì‹œì•ˆë¸”ë£¨ Â· 6ì„¸",
        meta: "ê¸°ë³¸ ê±´ê°•/ì‹ë‹¨ ìƒë‹´.",
        tags: ["ì‹ë‹¨", "ì²´ì¤‘", "ìŠµê´€"],
        quick: ["ì‚¬ë£Œ ê¸‰ì—¬ëŸ‰ ê¸°ì¤€ ì•Œë ¤ì¤˜", "ë¬¼ ì„­ì·¨ ëŠ˜ë¦¬ëŠ” ë°©ë²•ì€?", "í„¸ ë¹ ì§ ê´€ë¦¬ íŒ"],
        avatarSvg: avatarCat("#5eead4", "RB")
      },
    ];

    // ê°„ë‹¨í•œ ì¸ë¼ì¸ SVG ì•„ë°”íƒ€
    function avatarDog(color, label){
      return `
        <svg width="46" height="46" viewBox="0 0 46 46" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0" stop-color="${color}" stop-opacity="0.55"/>
              <stop offset="1" stop-color="#ffffff" stop-opacity="0.08"/>
            </linearGradient>
          </defs>
          <rect x="1" y="1" width="44" height="44" rx="14" fill="url(#g)" stroke="rgba(255,255,255,.16)"/>
          <circle cx="23" cy="24" r="10" fill="rgba(255,255,255,.22)"/>
          <circle cx="18" cy="22" r="2" fill="rgba(255,255,255,.9)"/>
          <circle cx="28" cy="22" r="2" fill="rgba(255,255,255,.9)"/>
          <path d="M20 27c2 2 4 2 6 0" stroke="rgba(255,255,255,.9)" stroke-width="2" stroke-linecap="round"/>
          <path d="M14 18c-2-3 0-6 3-6" stroke="rgba(255,255,255,.55)" stroke-width="2" stroke-linecap="round"/>
          <path d="M32 18c2-3 0-6-3-6" stroke="rgba(255,255,255,.55)" stroke-width="2" stroke-linecap="round"/>
          <text x="23" y="40" text-anchor="middle" font-size="9" fill="rgba(255,255,255,.85)" font-family="Suit" font-weight="800">${label}</text>
        </svg>
      `;
    }

    function avatarCat(color, label){
      return `
        <svg width="46" height="46" viewBox="0 0 46 46" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <linearGradient id="g2" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0" stop-color="${color}" stop-opacity="0.55"/>
              <stop offset="1" stop-color="#ffffff" stop-opacity="0.08"/>
            </linearGradient>
          </defs>
          <rect x="1" y="1" width="44" height="44" rx="14" fill="url(#g2)" stroke="rgba(255,255,255,.16)"/>
          <path d="M16 21l-2-4 4 2M30 21l2-4-4 2" fill="rgba(255,255,255,.22)"/>
          <circle cx="23" cy="25" r="10" fill="rgba(255,255,255,.20)"/>
          <circle cx="19" cy="24" r="2" fill="rgba(255,255,255,.9)"/>
          <circle cx="27" cy="24" r="2" fill="rgba(255,255,255,.9)"/>
          <path d="M21 28c1 1 3 1 4 0" stroke="rgba(255,255,255,.9)" stroke-width="2" stroke-linecap="round"/>
          <text x="23" y="40" text-anchor="middle" font-size="9" fill="rgba(255,255,255,.85)" font-family="Suit" font-weight="800">${label}</text>
        </svg>
      `;
    }

    // =========================
    // ìƒíƒœ/DOM
    // =========================
    const petListEl = document.getElementById('petList');
    const chatEl = document.getElementById('chat');
    const headerTitle = document.getElementById('headerTitle');
    const headerSub = document.getElementById('headerSub');
    const quickRow = document.getElementById('quickRow');

    const form = document.getElementById('form');
    const input = document.getElementById('input');
    const sendBtn = document.getElementById('sendBtn');
    const clearBtn = document.getElementById('clearBtn');
    const resetBtn = document.getElementById('resetBtn');

    let selectedPetId = PETS[0].id;

    function getSelectedPet(){
      return PETS.find(p => p.id === selectedPetId) || PETS[0];
    }

    function addMsg(text, who, isError=false) {
      const row = document.createElement('div');
      row.className = `msg ${who}${isError ? ' error' : ''}`;
      const bubble = document.createElement('div');
      bubble.className = 'bubble';
      bubble.textContent = text;
      row.appendChild(bubble);
      chatEl.appendChild(row);
      chatEl.scrollTop = chatEl.scrollHeight;
    }

    function setHeader(){
      const pet = getSelectedPet();
      headerTitle.textContent = `${pet.name} ìƒë‹´`;
      headerSub.textContent = `${pet.type} Â· ${pet.meta}`;
      input.placeholder = `${pet.name}ì— ëŒ€í•´ ë¬¼ì–´ë³´ì„¸ìš”â€¦`;
    }

    function renderQuick(){
      const pet = getSelectedPet();
      quickRow.innerHTML = "";
      pet.quick.forEach(q => {
        const b = document.createElement("button");
        b.type = "button";
        b.className = "quick";
        b.textContent = q;
        b.addEventListener("click", () => {
          input.value = q;
          input.focus();
        });
        quickRow.appendChild(b);
      });
    }

    function renderPets(){
      petListEl.innerHTML = "";
      PETS.forEach(p => {
        const card = document.createElement("div");
        card.className = "petCard" + (p.id === selectedPetId ? " active" : "");
        card.addEventListener("click", () => {
          if (selectedPetId === p.id) return;
          selectedPetId = p.id;
          renderPets();
          setHeader();
          renderQuick();
          addMsg(`âœ… ëŒ€ìƒì´ "${p.name}"(ìœ¼)ë¡œ ë³€ê²½ëì–´ìš”.\nì´ì œ ${p.name}ì— ëŒ€í•´ì„œë§Œ ì§ˆë¬¸í•´ ì£¼ì„¸ìš”.`, "bot");
        });

        const avatar = document.createElement("div");
        avatar.className = "avatar";
        avatar.innerHTML = p.avatarSvg;

        const info = document.createElement("div");
        info.className = "petInfo";
        info.innerHTML = `
          <div class="petNameRow">
            <p class="petName">${p.name}</p>
            <span class="petType">${p.type}</span>
          </div>
          <div class="petMeta">${p.meta}</div>
          <div class="tagRow">
            ${p.tags.map(t => `<span class="tag">${t}</span>`).join("")}
          </div>
        `;

        card.appendChild(avatar);
        card.appendChild(info);
        petListEl.appendChild(card);
      });
    }

    function resetIntro(){
      const pet = getSelectedPet();
      addMsg(
`ì•ˆë…•í•˜ì„¸ìš”! ì €ëŠ” POODi(í‘¸ë””)ì˜ˆìš”.
í˜„ì¬ ì„ íƒëœ ëŒ€ìƒ: ${pet.name}

ê·œì¹™:
- ${pet.name}ì— ëŒ€í•´ì„œë§Œ ì§ˆë¬¸í•´ ì£¼ì„¸ìš”.
- ë‹¤ë¥¸ ì§ˆë¬¸ì€ â€œ${pet.name} ê´€ë ¨ ì§ˆë¬¸â€ìœ¼ë¡œ ë°”ê¿”ë‹¬ë¼ê³  ì•ˆë‚´í• ê²Œìš”.

ì˜ˆì‹œ:
- ${pet.name} ì¦ìƒ/ì‹ë‹¨/ìƒí™œìŠµê´€ ìƒë‹´
- ${pet.name}ì—ê²Œ ë§ëŠ” ìš´ë™/ê°„ì‹/ê´€ë¦¬ ë£¨í‹´`,
        "bot"
      );
    }

    async function sendMessage(text){
      const pet = getSelectedPet();
      sendBtn.disabled = true;

      addMsg(text, 'me');

      // ë¡œë”©
      const loadingRow = document.createElement('div');
      loadingRow.className = 'msg bot';
      const loadingBubble = document.createElement('div');
      loadingBubble.className = 'bubble';
      loadingBubble.textContent = 'ë‹µë³€ ì¤‘â€¦';
      loadingRow.appendChild(loadingBubble);
      chatEl.appendChild(loadingRow);
      chatEl.scrollTop = chatEl.scrollHeight;

      try{
        const res = await fetch('/api/chat', {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({ message: text, petId: pet.id })
        });

        const raw = await res.text();
        loadingRow.remove();

        if(!res.ok){
          addMsg(`ì„œë²„ ì—ëŸ¬ (${res.status})\n${raw}`, 'bot', true);
          return;
        }

        let data;
        try{ data = JSON.parse(raw); }
        catch{
          addMsg(`ì‘ë‹µ íŒŒì‹± ì‹¤íŒ¨:\n${raw}`, 'bot', true);
          return;
        }

        addMsg(data.reply ?? '(ì‘ë‹µì´ ë¹„ì–´ìˆì–´ìš”)', 'bot');
      }catch(err){
        loadingRow.remove();
        addMsg(`ë„¤íŠ¸ì›Œí¬/ì—°ê²° ì—ëŸ¬:\n${err?.message ?? err}`, 'bot', true);
      }finally{
        sendBtn.disabled = false;
      }
    }

    // ì´ë²¤íŠ¸
    form.addEventListener('submit', (e) => {
      e.preventDefault();
      const text = input.value.trim();
      if(!text) return;
      input.value = '';
      sendMessage(text);
    });

    clearBtn.addEventListener("click", () => {
      chatEl.innerHTML = "";
      resetIntro();
    });

    resetBtn.addEventListener("click", () => {
      const pet = getSelectedPet();
      addMsg(`ğŸ” í˜„ì¬ ì„ íƒ: ${pet.name}\n${pet.name} ê´€ë ¨ ì§ˆë¬¸ë§Œ ë¶€íƒí•´ìš”!`, "bot");
    });

    // ì´ˆê¸° ë Œë”
    renderPets();
    setHeader();
    renderQuick();
    resetIntro();
  </script>
</body>
</html>